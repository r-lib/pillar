<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Printing a tibble: Control and data flow • pillar</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Printing a tibble: Control and data flow">
<meta name="robots" content="noindex">
<script defer data-domain="pillar.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pillar</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.9.0.9018</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/pillar_options.html">Options</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/extending.html">Custom formatting</a></li>
    <li><a class="dropdown-item" href="../articles/printing.html">Printing a tibble: Control and data flow</a></li>
    <li><a class="dropdown-item" href="../articles/debugme.html">Printing a tibble: Tracking control flow</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/pillar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">



<link href="printing_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="printing_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="printing_files/d3-3.3.8/d3.min.js"></script><script src="printing_files/dagre-0.4.0/dagre-d3.min.js"></script><link href="printing_files/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="printing_files/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><link href="printing_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="printing_files/chromatography-0.1/chromatography.js"></script><script src="printing_files/DiagrammeR-binding-1.0.11/DiagrammeR.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Printing a tibble: Control and data flow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/pillar/blob/main/vignettes/printing.Rmd" class="external-link"><code>vignettes/printing.Rmd</code></a></small>
      <div class="d-none name"><code>printing.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pillar.r-lib.org/">pillar</a></span><span class="op">)</span></span></code></pre></div>
<p>What happens when a tibble is printed? This vignette documents the
control flow and the data flow, explains the design choices, and shows
the default implementation for the <code>"tbl"</code> class. It is
mainly of interest for implementers of table subclasses. Customizing the
formatting of a vector class in a tibble is described in
<code><a href="https://vctrs.r-lib.org/articles/pillar.html" class="external-link">vignette("pillar", package = "vctrs")</a></code>. The different
customization options are showcased in
<code><a href="../articles/extending.html">vignette("extending")</a></code>.</p>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<ul>
<li><p>Fit into pre-specified width, distributing across multiple tiers
if necessary</p></li>
<li><p>Optionally shrink and stretch individual columns</p></li>
<li>
<p>Header, body and footer for the tibble</p>
<ul>
<li>Avoid recomputation of information</li>
</ul>
</li>
<li>
<p>Custom components for the pillars in a tibble, top-aligned</p>
<ul>
<li>The container, not the column vectors, determine the appearance</li>
</ul>
</li>
<li><p>Customization of the entire output and of the pillars</p></li>
<li><p>Support for data frame columns (packed data frames) and
matrix/array columns</p></li>
<li>
<p>Pillars are always shown from left to right, no “holes” in the
colonnade</p>
<ul>
<li>If the first column consumes all available space, the remaining
columns are not shown, even if they all would fit if the first column is
omitted.</li>
</ul>
</li>
<li><p>Printing pillars should take time proportional to the number of
characters printed, and be “fast enough”.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The overall control and data flow are illustrated in the diagram
below. Boxes are functions and methods. Solid lines are function calls.
Dotted lines represent information that a function obtains via argument
or (in the case of options) queries actively.</p>
<div class="DiagrammeR html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:700px;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"graph TD\n  print.tbl[\"print.tbl()\"] --> format.tbl[\"format.tbl()\"]\n  format.tbl --> tbl_format_setup[\"tbl_format_setup()\"]\n  options(Options: n and n_extra) -.-> tbl_format_setup\n  format.tbl --> tbl_format_header[\"tbl_format_header()\"]\n  format.tbl --> tbl_format_body[\"tbl_format_body()\"]\n  format.tbl --> tbl_format_footer[\"tbl_format_footer()\"]\n  tbl_format_setup -.-> tbl_sum[\"tbl_sum()\"]\n  tbl_sum -.-> setup(Setup object)\n  tbl_format_setup -.-> ctl_new_compound_pillar[\"ctl_new_compound_pillar()\"]\n  ctl_new_compound_pillar -.-> ctl_new_pillar[\"ctl_new_pillar()\"]\n  ctl_new_pillar -.-> setup(Setup object)\n  setup -.-> tbl_format_header\n  setup -.-> tbl_format_body\n  setup -.-> tbl_format_footer\n  tbl_format_header -.-> print(Printed output)\n  tbl_format_body -.-> print\n  tbl_format_footer -.-> print"},"evals":[],"jsHooks":[]}</script><p>The pillar package uses debugme for debugging. Activating debugging
for pillar is another way to track the control flow, see
<code><a href="../articles/debugme.html">vignette("debugme")</a></code> for details.</p>
</div>
<div class="section level2">
<h2 id="initialization">Initialization<a class="anchor" aria-label="anchor" href="#initialization"></a>
</h2>
<p>A tibble is a list of columns of class <code>"tbl_df"</code> and
<code>"tbl"</code>. Printing is designed to work for non-data-frame
table-like objects such as lazy tables. The <code><a href="../reference/format_tbl.html">print.tbl()</a></code>
method calls <code><a href="https://rdrr.io/r/base/format.html" class="external-link">format()</a></code> for the object and prints the
output.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, b <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>c <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">6</span>, d <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>, e <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tbl</span>, width <span class="op">=</span> <span class="fl">23</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;       a   b$c     e</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1     4    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2     5    11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3     6    12</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable:</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   b$d &lt;int&gt;</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [3 × 3] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ a: int [1:3] 1 2 3</span></span>
<span><span class="co">#&gt;  $ b: tibble [3 × 2] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;   ..$ c: int [1:3] 4 5 6</span></span>
<span><span class="co">#&gt;   ..$ d: int [1:3] 7 8 9</span></span>
<span><span class="co">#&gt;  $ e: int [1:3] 10 11 12</span></span></code></pre></div>
<details><summary>
Source code of <code>pillar:::print.tbl()</code>
</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">print.tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">width</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span>, <span class="va">n</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">max_extra_cols</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                      <span class="va">max_footer_lines</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">print_tbl</span><span class="op">(</span></span>
<span>    <span class="va">x</span>, <span class="va">width</span>, <span class="va">...</span>,</span>
<span>    n <span class="op">=</span> <span class="va">n</span>, max_extra_cols <span class="op">=</span> <span class="va">max_extra_cols</span>, max_footer_lines <span class="op">=</span> <span class="va">max_footer_lines</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><p>The <code><a href="../reference/format_tbl.html">format.tbl()</a></code> method creates a setup object, and uses
that object to format header, body and footer.</p>
<details><summary>
Source code of <code>pillar:::format.tbl()</code>
</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">format.tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">width</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span>,</span>
<span>                       <span class="va">n</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">max_extra_cols</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">max_footer_lines</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/format_tbl.html">format_tbl</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>, <span class="va">width</span>, <span class="va">...</span>,</span>
<span>    n <span class="op">=</span> <span class="va">n</span>, max_extra_cols <span class="op">=</span> <span class="va">max_extra_cols</span>, max_footer_lines <span class="op">=</span> <span class="va">max_footer_lines</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><p>While it’s possible to extend or override these methods for your
<code>"tbl"</code> subclass, often overriding the more specialized
methods shown below is sufficient.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Most of the work for formatting actually happens in
<code><a href="../reference/tbl_format_setup.html">tbl_format_setup()</a></code>. The desired output width is baked into
the setup object and must be available when calling. Setup objects print
like a tibble but with a clear separation of header, body, and
footer.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">setup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tbl_format_setup.html">tbl_format_setup</a></span><span class="op">(</span><span class="va">tbl</span>, width <span class="op">=</span> <span class="fl">24</span><span class="op">)</span></span>
<span><span class="va">setup</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">&lt;pillar_tbl_format_setup&gt;</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">&lt;tbl_format_header(setup)&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">&lt;tbl_format_body(setup)&gt;</span></span></span>
<span><span class="co">#&gt;       a   b$c     e</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1     4    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2     5    11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3     6    12</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">&lt;tbl_format_footer(setup)&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable:</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   b$d &lt;int&gt;</span></span></span></code></pre></div>
<p>A setup object is required here to avoid computing information twice.
For instance, the dimensions shown in the header or the extra columns
displayed in the footer are available only after the body has been
computed.</p>
<p>The generic dispatches over the container, so that you can override
it if necessary. It is responsible for assigning default values to
arguments before passing them on to the method.</p>
<details><summary>
Source code of <code>tbl_format_setup()</code>
</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_format_setup</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">width</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span>,</span>
<span>                             <span class="va">n</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">max_extra_cols</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             <span class="va">max_footer_lines</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             <span class="va">focus</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="st">"!!!!DEBUG tbl_format_setup()"</span></span>
<span></span>
<span>  <span class="va">width</span> <span class="op">&lt;-</span> <span class="fu">get_width_print</span><span class="op">(</span><span class="va">width</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu">get_n_print</span><span class="op">(</span><span class="va">n</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">max_extra_cols</span> <span class="op">&lt;-</span> <span class="fu">get_max_extra_cols</span><span class="op">(</span><span class="va">max_extra_cols</span><span class="op">)</span></span>
<span>  <span class="va">max_footer_lines</span> <span class="op">&lt;-</span> <span class="fu">get_max_footer_lines</span><span class="op">(</span><span class="va">max_footer_lines</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Calls UseMethod("tbl_format_setup"),</span></span>
<span>  <span class="co"># allows using default values in S3 dispatch</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">tbl_format_setup_dispatch</span><span class="op">(</span></span>
<span>    <span class="va">x</span>, <span class="va">width</span>, <span class="va">...</span>,</span>
<span>    n <span class="op">=</span> <span class="va">n</span>, max_extra_cols <span class="op">=</span> <span class="va">max_extra_cols</span>, max_footer_lines <span class="op">=</span> <span class="va">max_footer_lines</span>,</span>
<span>    focus <span class="op">=</span> <span class="va">focus</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"tbl_format_setup"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><p>The default implementation converts the input to a data frame via
<code>as.data.frame(head(x))</code>, and returns an object constructed
with <code><a href="../reference/new_tbl_format_setup.html">new_tbl_format_setup()</a></code> that contains the data frame
and additional information. If you override this method, e.g. to
incorporate more information, you can add new items to the default setup
object, but you should not overwrite existing items.</p>
<details><summary>
Source code of <code>pillar:::tbl_format_setup.tbl()</code>
</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_format_setup.tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">width</span>, <span class="va">...</span>,</span>
<span>                                 <span class="va">n</span>, <span class="va">max_extra_cols</span>, <span class="va">max_footer_lines</span>, <span class="va">focus</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="st">"!!!!DEBUG tbl_format_setup.tbl()"</span></span>
<span></span>
<span>  <span class="co"># Number of rows</span></span>
<span>  <span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">df_head</span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">rows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">vec_head</span><span class="op">(</span><span class="va">df</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">df_head</span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Lazy table with too many rows</span></span>
<span>    <span class="va">needs_dots</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># Lazy table with few rows, or regular data frame</span></span>
<span>    <span class="va">needs_dots</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">rows</span> <span class="op">&gt;</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">needs_dots</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">rows_missing</span> <span class="op">&lt;-</span> <span class="va">rows</span> <span class="op">-</span> <span class="va">n</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">rows_missing</span> <span class="op">&lt;-</span> <span class="fl">0L</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Header</span></span>
<span>  <span class="va">tbl_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tbl_sum.html">tbl_sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Body</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span>  <span class="va">colonnade</span> <span class="op">&lt;-</span> <span class="fu">ctl_colonnade</span><span class="op">(</span></span>
<span>    <span class="va">df</span>,</span>
<span>    has_row_id <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/base-internal.html" class="external-link">.row_names_info</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="st">"*"</span> <span class="kw">else</span> <span class="cn">TRUE</span>,</span>
<span>    width <span class="op">=</span> <span class="va">width</span>,</span>
<span>    controller <span class="op">=</span> <span class="va">x</span>,</span>
<span>    focus <span class="op">=</span> <span class="va">focus</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">body</span> <span class="op">&lt;-</span> <span class="va">colonnade</span><span class="op">$</span><span class="va">body</span></span>
<span></span>
<span>  <span class="co"># Extra columns</span></span>
<span>  <span class="va">extra_cols</span> <span class="op">&lt;-</span> <span class="va">colonnade</span><span class="op">$</span><span class="va">extra_cols</span></span>
<span>  <span class="va">extra_cols_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">extra_cols</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">extra_cols_total</span> <span class="op">&gt;</span> <span class="va">max_extra_cols</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">extra_cols</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">max_extra_cols</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Abbreviated columns</span></span>
<span>  <span class="va">abbrev_cols</span> <span class="op">&lt;-</span> <span class="va">colonnade</span><span class="op">$</span><span class="va">abbrev_cols</span></span>
<span></span>
<span>  <span class="co"># Result</span></span>
<span>  <span class="fu"><a href="../reference/new_tbl_format_setup.html">new_tbl_format_setup</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">x</span>,</span>
<span>    df <span class="op">=</span> <span class="va">df</span>,</span>
<span>    width <span class="op">=</span> <span class="va">width</span>,</span>
<span>    tbl_sum <span class="op">=</span> <span class="va">tbl_sum</span>,</span>
<span>    body <span class="op">=</span> <span class="va">body</span>,</span>
<span>    rows_missing <span class="op">=</span> <span class="va">rows_missing</span>,</span>
<span>    rows_total <span class="op">=</span> <span class="va">rows</span>,</span>
<span>    extra_cols <span class="op">=</span> <span class="va">extra_cols</span>,</span>
<span>    extra_cols_total <span class="op">=</span> <span class="va">extra_cols_total</span>,</span>
<span>    max_footer_lines <span class="op">=</span> <span class="va">max_footer_lines</span>,</span>
<span>    abbrev_cols <span class="op">=</span> <span class="va">abbrev_cols</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><p>At the core, the internal function <code>ctl_colonnade()</code>
composes the body. Its functionality and the customization points it
offers are detailed in the “Colonnade” section below.</p>
</div>
<div class="section level2">
<h2 id="header-body-footer">Header, body, footer<a class="anchor" aria-label="anchor" href="#header-body-footer"></a>
</h2>
<p>The components of a tibble are formatted with
<code>tbl_format_*()</code> generics, which also dispatch on the
container to allow extension or overrides. They return a character
vector, with one element per line printed. The setup object is
required.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tbl_format_header.html">tbl_format_header</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">setup</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "\033[38;5;246m# A tibble: 3 × 3\033[39m"</span></span>
<span><span class="fu"><a href="../reference/tbl_format_body.html">tbl_format_body</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">setup</span><span class="op">)</span></span>
<span><span class="co">#&gt;       a   b$c     e</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1     4    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2     5    11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3     6    12</span></span>
<span><span class="fu"><a href="../reference/tbl_format_footer.html">tbl_format_footer</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">setup</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "\033[38;5;246m# ℹ 1 more variable:\033[39m"</span></span>
<span><span class="co">#&gt; [2] "\033[38;5;246m#   b$d &lt;int&gt;\033[39m"</span></span></code></pre></div>
<p>(The body is returned as a classed object with a <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>
method, it is still a <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> under the hood.)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="../reference/tbl_format_body.html">tbl_format_body</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">setup</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "glue"      "character"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="fu"><a href="../reference/tbl_format_body.html">tbl_format_body</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">setup</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "character"</span></span></code></pre></div>
<p>Since most of the work already has been carried out in
<code><a href="../reference/tbl_format_setup.html">tbl_format_setup()</a></code>, the default implementations mostly
consist of code that styles and wraps the output.</p>
<details><summary>
Source code of <code>pillar:::tbl_format_header.tbl()</code>
</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_format_header.tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">setup</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">named_header</span> <span class="op">&lt;-</span> <span class="va">setup</span><span class="op">$</span><span class="va">tbl_sum</span></span>
<span>  <span class="va">focus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"pillar_focus"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">focus</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">named_header</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">named_header</span>, <span class="st">"Focus columns"</span> <span class="op">=</span> <span class="fu">collapse</span><span class="op">(</span><span class="fu">tick_if_needed</span><span class="op">(</span><span class="va">focus</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu">names2</span><span class="op">(</span><span class="va">named_header</span><span class="op">)</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">header</span> <span class="op">&lt;-</span> <span class="va">named_header</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">header</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/align.html">align</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu">names2</span><span class="op">(</span><span class="va">named_header</span><span class="op">)</span>, <span class="st">":"</span><span class="op">)</span>, space <span class="op">=</span> <span class="va">NBSP</span><span class="op">)</span>,</span>
<span>      <span class="co"># We add a space after the NBSP inserted by align()</span></span>
<span>      <span class="co"># so that wrapping occurs at the right location for very narrow outputs</span></span>
<span>      <span class="st">" "</span>,</span>
<span>      <span class="va">named_header</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/style_subtle.html">style_subtle</a></span><span class="op">(</span><span class="fu">format_comment</span><span class="op">(</span><span class="va">header</span>, width <span class="op">=</span> <span class="va">setup</span><span class="op">$</span><span class="va">width</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><details><summary>
Source code of <code>pillar:::tbl_format_body.tbl()</code>
</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_format_body.tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">setup</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/force.html" class="external-link">force</a></span><span class="op">(</span><span class="va">setup</span><span class="op">)</span></span>
<span>  <span class="va">setup</span><span class="op">$</span><span class="va">body</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><details><summary>
Source code of <code>pillar:::tbl_format_footer.tbl()</code>
</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tbl_format_footer.tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">setup</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">footer</span> <span class="op">&lt;-</span> <span class="fu">format_footer</span><span class="op">(</span><span class="va">x</span>, <span class="va">setup</span><span class="op">)</span></span>
<span>  <span class="va">footer_comment</span> <span class="op">&lt;-</span> <span class="fu">wrap_footer_bullet</span><span class="op">(</span><span class="va">footer</span>, <span class="va">setup</span><span class="op">)</span></span>
<span>  <span class="va">footer_advice</span> <span class="op">&lt;-</span> <span class="fu">format_footer_advice</span><span class="op">(</span><span class="va">x</span>, <span class="va">setup</span><span class="op">)</span></span>
<span>  <span class="va">footer_advice_comment</span> <span class="op">&lt;-</span> <span class="fu">wrap_footer_bullet</span><span class="op">(</span></span>
<span>    <span class="va">footer_advice</span>,</span>
<span>    <span class="va">setup</span>,</span>
<span>    lines <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    ellipsis <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    bullet <span class="op">=</span> <span class="va">symbol</span><span class="op">$</span><span class="va">info</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/style_subtle.html">style_subtle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">footer_comment</span>, <span class="va">footer_advice_comment</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="colonnade">Colonnade<a class="anchor" aria-label="anchor" href="#colonnade"></a>
</h2>
<p>The internal function <code>ctl_colonnade()</code> composes the body.
It performs the following tasks:</p>
<ol style="list-style-type: decimal">
<li>Create a pillar object for every top-level column that fits, using
the minimum width, via <code><a href="../reference/ctl_new_pillar_list.html">ctl_new_pillar_list()</a></code>,
<code><a href="../reference/ctl_new_pillar.html">ctl_new_pillar()</a></code> and ultimately <code><a href="../reference/pillar.html">pillar()</a></code> and
<code><a href="../reference/pillar_shaft.html">pillar_shaft()</a></code>
</li>
<li>Determine the number of tiers and the width for each tier</li>
<li>Distribute the pillars across the tiers, assigning a width to each
pillar.</li>
<li>Format each pillar via its <code><a href="https://rdrr.io/r/base/format.html" class="external-link">format()</a></code> function, passing
the now known width.</li>
<li>Combine the formatted pillars horizontally.</li>
<li>Combine the tiers vertically.</li>
<li>Return the formatted body, and the columns that could not fit.</li>
</ol>
<p>In the following, the first and the fourth steps are discussed.</p>
</div>
<div class="section level2">
<h2 id="creating-pillar-objects">Creating pillar objects<a class="anchor" aria-label="anchor" href="#creating-pillar-objects"></a>
</h2>
<p>The initial tibble is passed to <code><a href="../reference/ctl_new_pillar_list.html">ctl_new_pillar_list()</a></code>,
which eventually calls <code><a href="../reference/ctl_new_pillar.html">ctl_new_pillar()</a></code> once or several
times. For each top-level column, one pillar object is constructed. The
loop is terminated when the available width is exhausted even
considering the minimum width.</p>
<div class="section level3">
<h3 id="pillar-lists">Pillar lists<a class="anchor" aria-label="anchor" href="#pillar-lists"></a>
</h3>
<p>The <code><a href="../reference/ctl_new_pillar_list.html">ctl_new_pillar_list()</a></code> generic dispatches on the
container:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ctl_new_pillar_list.html">ctl_new_pillar_list</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">tbl</span><span class="op">$</span><span class="va">a</span>, width <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; &lt;pillar&gt;</span></span>
<span><span class="co">#&gt; <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt;     1</span></span>
<span><span class="co">#&gt;     2</span></span>
<span><span class="co">#&gt;     3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"remaining_width")</span></span>
<span><span class="co">#&gt; [1] 14</span></span>
<span><span class="co">#&gt; attr(,"simple")</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="../reference/ctl_new_pillar_list.html">ctl_new_pillar_list</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">tbl</span><span class="op">$</span><span class="va">b</span>, width <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; &lt;pillar&gt;</span></span>
<span><span class="co">#&gt;     c</span></span>
<span><span class="co">#&gt; <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt;     4</span></span>
<span><span class="co">#&gt;     5</span></span>
<span><span class="co">#&gt;     6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; &lt;pillar&gt;</span></span>
<span><span class="co">#&gt;     d</span></span>
<span><span class="co">#&gt; <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt;     7</span></span>
<span><span class="co">#&gt;     8</span></span>
<span><span class="co">#&gt;     9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attr(,"extra")</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span><span class="co">#&gt; attr(,"remaining_width")</span></span>
<span><span class="co">#&gt; [1] 8</span></span>
<span><span class="co">#&gt; attr(,"simple")</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>In a tibble, each column can be a data frame, matrix, or even array
itself, such columns are called <em>compound columns</em>. Such columns
are decomposed into sub-pillars and returned as a list of pillars.
Regular vectors are forwarded to <code><a href="../reference/ctl_new_pillar.html">ctl_new_pillar()</a></code> and
returned as list of length one. Implementers of <code>"tbl"</code>
subclasses will rarely if ever need to extend or override this
method.</p>
<details><summary>
Source code of <code>pillar:::ctl_new_pillar_list.tbl()</code>
</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctl_new_pillar_list.tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">controller</span>, <span class="va">x</span>, <span class="va">width</span>, <span class="va">...</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">first_pillar</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="st">"!!!!DEBUG ctl_new_pillar_list.tbl(`v(width)`, `v(title)`)"</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">new_data_frame_pillar_list</span><span class="op">(</span><span class="va">x</span>, <span class="va">controller</span>, <span class="va">width</span>, title <span class="op">=</span> <span class="va">title</span>, first_pillar <span class="op">=</span> <span class="va">first_pillar</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Surv"</span>, <span class="st">"Surv2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">new_matrix_pillar_list</span><span class="op">(</span><span class="va">x</span>, <span class="va">controller</span>, <span class="va">width</span>, title <span class="op">=</span> <span class="va">title</span>, first_pillar <span class="op">=</span> <span class="va">first_pillar</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">is.array</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">new_array_pillar_list</span><span class="op">(</span><span class="va">x</span>, <span class="va">controller</span>, <span class="va">width</span>, title <span class="op">=</span> <span class="va">title</span>, first_pillar <span class="op">=</span> <span class="va">first_pillar</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">first_pillar</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">first_pillar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctl_new_pillar.html">ctl_new_pillar</a></span><span class="op">(</span><span class="va">controller</span>, <span class="va">x</span>, <span class="va">width</span>, <span class="va">...</span>, title <span class="op">=</span> <span class="fu">prepare_title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu">new_single_pillar_list</span><span class="op">(</span><span class="va">first_pillar</span>, <span class="va">width</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="simple-pillars">Simple pillars<a class="anchor" aria-label="anchor" href="#simple-pillars"></a>
</h3>
<p>The <code><a href="../reference/ctl_new_pillar.html">ctl_new_pillar()</a></code> method is called for columns that
are not data frames or arrays, and also dispatches over the
container.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ctl_new_pillar.html">ctl_new_pillar</a></span><span class="op">(</span><span class="va">tbl</span>, <span class="va">tbl</span><span class="op">$</span><span class="va">a</span>, width <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;pillar&gt;</span></span>
<span><span class="co">#&gt; <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt;     1</span></span>
<span><span class="co">#&gt;     2</span></span>
<span><span class="co">#&gt;     3</span></span></code></pre></div>
<details><summary>
Source code of <code>pillar:::ctl_new_pillar.tbl()</code>
</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctl_new_pillar.tbl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">controller</span>, <span class="va">x</span>, <span class="va">width</span>, <span class="va">...</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="st">"!!!!DEBUG ctl_new_pillar.tbl(`v(width)`, `v(title)`)"</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/pillar.html">pillar</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">title</span>, <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="fu">max0</span><span class="op">(</span><span class="va">width</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><p>The default method calls <code><a href="../reference/pillar.html">pillar()</a></code> directly, passing the
maximum width available.</p>
<details><summary>
Source code of <code>pillar()</code>
</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pillar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">width</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="st">"!!!!DEBUG pillar(`v(class(x))`, `v(title)`, `v(width)`)"</span></span>
<span></span>
<span>  <span class="fu">pillar_from_shaft</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/new_pillar_title.html">new_pillar_title</a></span><span class="op">(</span><span class="va">title</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/new_pillar_type.html">new_pillar_type</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/pillar_shaft.html">pillar_shaft</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span>,</span>
<span>    <span class="va">width</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><p>Formatting for title and type is provided by
<code><a href="../reference/new_pillar_title.html">new_pillar_title()</a></code> and <code><a href="../reference/new_pillar_type.html">new_pillar_type()</a></code>. The
body can be customized by implementing <code><a href="../reference/pillar_shaft.html">pillar_shaft()</a></code> for a
vector class, see <code><a href="https://vctrs.r-lib.org/articles/pillar.html" class="external-link">vignette("pillar", package = "vctrs")</a></code> for
details. If title or type don’t fit the available width,
<code><a href="../reference/pillar_shaft.html">pillar_shaft()</a></code> is never called.</p>
<p>This function now returns <code>NULL</code> if the width is
insufficient to contain the data. It is possible to change the
appearance of pillars by overriding or extending
<code><a href="../reference/ctl_new_pillar.html">ctl_new_pillar()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="components">Components<a class="anchor" aria-label="anchor" href="#components"></a>
</h3>
<p>Pillar objects share the same structure and are ultimately
constructed with <code><a href="../reference/new_pillar.html">new_pillar()</a></code>.</p>
<details><summary>
Source code of <code>new_pillar()</code>
</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_pillar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">components</span>, <span class="va">...</span>, <span class="va">width</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">class</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                       <span class="va">extra</span> <span class="op">=</span> <span class="fu"><a href="../reference/deprecated.html">deprecated</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="st">"!!!!DEBUG new_pillar(`v(width)`, `v(class)`)"</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">is_present</span><span class="op">(</span><span class="va">extra</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Signal the deprecation to the user</span></span>
<span>    <span class="fu">deprecate_warn</span><span class="op">(</span><span class="st">"1.7.0"</span>, <span class="st">"pillar::new_pillar(extra = )"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu">check_dots_empty</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">components</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu">is_named</span><span class="op">(</span><span class="va">components</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">abort</span><span class="op">(</span><span class="st">"All components must have names."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span></span>
<span>    <span class="va">components</span>,</span>
<span>    width <span class="op">=</span> <span class="va">width</span>,</span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">class</span>, <span class="st">"pillar"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><p>A pillar is stored as a list of components. Each pillar represents
only one simple (atomic) column, compound columns are always represented
as multiple pillar objects.</p>
</div>
</div>
<div class="section level2">
<h2 id="formatting-pillars">Formatting pillars<a class="anchor" aria-label="anchor" href="#formatting-pillars"></a>
</h2>
<p>When a pillar object is constructed, it has a minimum and a desired
(maximum) width. Because it depends on the number and width of other
pillar objects that may not be even constructed, the final width is not
known yet. It is passed to <code><a href="https://rdrr.io/r/base/format.html" class="external-link">format()</a></code>, which uses the desired
width if empty:</p>
<details><summary>
Source code of <code>pillar:::format.pillar()</code>
</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">format.pillar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">width</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">width</span> <span class="op">&lt;-</span> <span class="fu">get_width</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">width</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">width</span> <span class="op">&lt;-</span> <span class="fu">pillar_get_width</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu">as_glue</span><span class="op">(</span><span class="fu">pillar_format_parts_2</span><span class="op">(</span><span class="va">x</span>, <span class="va">width</span><span class="op">)</span><span class="op">$</span><span class="va">aligned</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>, <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.9000.</p>
</div>

  </div></footer>
</body>
</html>
